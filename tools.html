<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>$EMO Tools ‚Äî Monad Utilities</title>
  <link rel="icon" type="image/png" href="token image.png">
  <link rel="apple-touch-icon" href="token image.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #333333;
      --text-secondary: #666666;
      --accent-color: #7B3FE4;
      --accent-light: #8D5AEC;
      --accent-dark: #5D2BB8;
      --button-bg: var(--accent-color);
      --button-hover: var(--accent-light);
      --button-text: #ffffff;
      --card-bg: #ffffff;
      --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      --contract-bg: #f8f0ff;
      --contract-border: #e9d5ff;
      --success-color: #22c55e;
      --error-color: #ef4444;
    }

    [data-theme="dark"] {
      --bg-color: #0a0a0a;
      --text-color: #ffffff;
      --text-secondary: #a0a0a0;
      --accent-color: #9B5FFF;
      --accent-light: #B080FF;
      --accent-dark: #7B3FE4;
      --card-bg: #1a1a1a;
      --card-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      --contract-bg: #1a1a2e;
      --contract-border: #3d3d5c;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: 'Space Grotesk', sans-serif;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 80px 20px 40px;
    }

    /* Price Ticker Header */
    .price-ticker {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-bottom: 1px solid var(--contract-border);
      padding: 10px 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      font-size: 14px;
      font-weight: 600;
      z-index: 99;
      backdrop-filter: blur(10px);
    }

    .price-ticker .token-name {
      color: var(--accent-color);
    }

    .price-ticker .price {
      color: var(--text-color);
      font-size: 16px;
    }

    .price-ticker .change {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 13px;
    }

    .price-ticker .change.positive {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
    }

    .price-ticker .change.negative {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }

    .price-ticker .mcap {
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 500;
    }

    /* Audio Player */
    .audio-player {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
    }

    .audio-player .player-btn {
      background: rgba(123, 63, 228, 0.3);
      border: 1px solid var(--accent-color);
      color: var(--accent-color);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: all 0.25s ease;
    }

    .audio-player .player-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: scale(1.15);
    }

    .audio-player .player-btn.play-btn {
      width: 36px;
      height: 36px;
      background: var(--accent-color);
      color: white;
      font-size: 18px;
    }

    .audio-player .player-btn.download-btn {
      text-decoration: none;
    }

    /* Theme Toggle in Header */
    .theme-toggle-header {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--accent-color);
      background: rgba(123, 63, 228, 0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s ease;
      margin-left: 10px;
      position: relative;
    }

    .theme-toggle-header:hover {
      transform: scale(1.1);
      background: rgba(123, 63, 228, 0.4);
    }

    .theme-toggle-header .icon-sun,
    .theme-toggle-header .icon-moon {
      position: absolute;
      transition: all 0.3s ease;
    }

    .theme-toggle-header .icon-sun {
      opacity: 0;
      transform: rotate(-90deg);
    }

    .theme-toggle-header .icon-moon {
      opacity: 1;
      transform: rotate(0deg);
    }

    [data-theme="dark"] .theme-toggle-header .icon-sun {
      opacity: 1;
      transform: rotate(0deg);
    }

    [data-theme="dark"] .theme-toggle-header .icon-moon {
      opacity: 0;
      transform: rotate(90deg);
    }

    .back-btn {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s ease;
      margin-left: 10px;
    }

    .back-btn:hover {
      background: var(--accent-light);
      transform: translateY(-1px);
    }

    @media (max-width: 768px) {
      .price-ticker {
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 10px;
      }
      .price-ticker .mcap {
        display: none;
      }
      .audio-player {
        margin-left: 0;
      }
    }

    .theme-toggle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--accent-color);
      background: rgba(123, 63, 228, 0.2);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      background: rgba(123, 63, 228, 0.4);
    }

    .theme-toggle .icon-sun,
    .theme-toggle .icon-moon {
      position: absolute;
      transition: all 0.3s ease;
    }

    .theme-toggle .icon-sun { opacity: 0; transform: rotate(-90deg); }
    .theme-toggle .icon-moon { opacity: 1; transform: rotate(0deg); }

    [data-theme="dark"] .theme-toggle .icon-sun { opacity: 1; transform: rotate(0deg); }
    [data-theme="dark"] .theme-toggle .icon-moon { opacity: 0; transform: rotate(90deg); }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 40px;
    }

    .page-title h1 {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--text-color);
      margin-bottom: 10px;
    }

    .page-title h1 span {
      color: var(--accent-color);
    }

    .page-title p {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Tool Card */
    .tool-card {
      background: var(--card-bg);
      border-radius: 20px;
      border: 1px solid var(--contract-border);
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
    }

    .tool-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--contract-border);
    }

    .tool-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--accent-color), var(--accent-dark));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .tool-title h2 {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 4px;
    }

    .tool-title p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-color);
    }

    .form-group .hint {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 6px;
    }

    .form-group .hint a {
      color: var(--accent-color);
      text-decoration: none;
    }

    .form-group .hint a:hover {
      text-decoration: underline;
    }

    .input-field {
      width: 100%;
      padding: 14px 18px;
      border-radius: 12px;
      border: 2px solid var(--contract-border);
      background: var(--contract-bg);
      color: var(--text-color);
      font-family: 'Space Grotesk', monospace;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(123, 63, 228, 0.2);
    }

    .input-field::placeholder {
      color: var(--text-secondary);
    }

    .input-row {
      display: flex;
      gap: 15px;
    }

    .input-row .form-group {
      flex: 1;
    }

    .input-row .form-group.small {
      flex: 0 0 120px;
    }

    /* Buttons */
    .btn {
      background: var(--accent-color);
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 12px;
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: var(--accent-light);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(123, 63, 228, 0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn.secondary {
      background: var(--contract-bg);
      color: var(--text-color);
      border: 2px solid var(--contract-border);
    }

    .btn.secondary:hover {
      background: var(--contract-border);
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Results Area */
    .results-area {
      margin-top: 25px;
      display: none;
    }

    .results-area.active {
      display: block;
    }

    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .results-header h3 {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-color);
    }

    .results-stats {
      display: flex;
      gap: 20px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .results-table th,
    .results-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--contract-border);
    }

    .results-table th {
      background: var(--contract-bg);
      font-weight: 600;
      color: var(--text-color);
      position: sticky;
      top: 0;
    }

    .results-table tr:hover {
      background: rgba(123, 63, 228, 0.05);
    }

    .results-table .address {
      font-family: monospace;
      font-size: 12px;
      color: var(--accent-color);
    }

    .results-table .amount {
      text-align: right;
      font-weight: 600;
    }

    .results-table .percentage {
      text-align: right;
      color: var(--text-secondary);
    }

    .results-container {
      max-height: 500px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid var(--contract-border);
    }

    .results-container::-webkit-scrollbar {
      width: 8px;
    }

    .results-container::-webkit-scrollbar-track {
      background: var(--contract-bg);
      border-radius: 4px;
    }

    .results-container::-webkit-scrollbar-thumb {
      background: var(--accent-color);
      border-radius: 4px;
    }

    /* Status Messages */
    .status {
      padding: 12px 18px;
      border-radius: 10px;
      margin-top: 15px;
      font-weight: 500;
      display: none;
    }

    .status.active {
      display: block;
    }

    .status.loading {
      background: rgba(123, 63, 228, 0.15);
      color: var(--accent-color);
      border: 1px solid var(--accent-color);
    }

    .status.success {
      background: rgba(34, 197, 94, 0.15);
      color: var(--success-color);
      border: 1px solid var(--success-color);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.15);
      color: var(--error-color);
      border: 1px solid var(--error-color);
    }

    /* API Key Notice */
    .api-notice {
      background: linear-gradient(135deg, rgba(123, 63, 228, 0.1), rgba(123, 63, 228, 0.05));
      border: 1px solid var(--accent-color);
      border-radius: 12px;
      padding: 15px 20px;
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .api-notice .notice-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .api-notice .notice-text {
      font-size: 0.9rem;
      color: var(--text-color);
    }

    .api-notice .notice-text strong {
      color: var(--accent-color);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 70px 15px 30px;
      }

      .page-title h1 {
        font-size: 1.8rem;
      }

      .tool-card {
        padding: 20px;
      }

      .input-row {
        flex-direction: column;
      }

      .input-row .form-group.small {
        flex: 1;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        justify-content: center;
      }

      .results-table {
        font-size: 12px;
      }

      .results-table th,
      .results-table td {
        padding: 10px 8px;
      }

      .results-table .address {
        font-size: 10px;
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .header-title {
        font-size: 1.1rem;
      }
    }

    /* Coming Soon Badge */
    .coming-soon {
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 10px;
    }

    .tool-card.disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Collapsible Tool Cards */
    .tool-card.collapsed .tool-content {
      display: none;
    }

    .tool-header {
      cursor: pointer;
      user-select: none;
    }

    .tool-header .toggle-icon {
      margin-left: auto;
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .tool-card.collapsed .toggle-icon {
      transform: rotate(-90deg);
    }

    /* Token Cards */
    .token-card {
      background: var(--contract-bg);
      border: 1px solid var(--contract-border);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .token-card .token-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .token-card .token-name {
      font-weight: 600;
      color: var(--text-color);
    }

    .token-card .token-address {
      font-family: monospace;
      font-size: 11px;
      color: var(--text-secondary);
    }

    .token-card .token-balance {
      text-align: right;
    }

    .token-card .token-amount {
      font-weight: 700;
      color: var(--text-color);
    }

    .token-card .token-value {
      font-size: 0.85rem;
      color: var(--success-color);
    }

    /* Trade Cards */
    .trade-card {
      background: var(--contract-bg);
      border: 1px solid var(--contract-border);
      border-radius: 12px;
      padding: 12px 15px;
      margin-bottom: 8px;
      display: grid;
      grid-template-columns: 80px 1fr 1fr 100px;
      align-items: center;
      gap: 10px;
    }

    .trade-card .trade-type {
      font-weight: 700;
      padding: 4px 10px;
      border-radius: 6px;
      text-align: center;
      font-size: 0.85rem;
    }

    .trade-card .trade-type.buy {
      background: rgba(34, 197, 94, 0.2);
      color: var(--success-color);
    }

    .trade-card .trade-type.sell {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error-color);
    }

    .trade-card .trade-amount {
      font-weight: 600;
    }

    .trade-card .trade-price {
      color: var(--text-secondary);
    }

    .trade-card .trade-time {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-align: right;
    }

    /* Pool Cards */
    .pool-card {
      background: var(--contract-bg);
      border: 1px solid var(--contract-border);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 10px;
    }

    .pool-card .pool-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .pool-card .pool-pair {
      font-weight: 700;
      color: var(--text-color);
    }

    .pool-card .pool-dex {
      background: var(--accent-color);
      color: white;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .pool-card .pool-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .pool-card .pool-stat {
      text-align: center;
    }

    .pool-card .pool-stat-label {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 2px;
    }

    .pool-card .pool-stat-value {
      font-weight: 600;
      color: var(--text-color);
    }

    /* Tabs */
    .tool-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tool-tab {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid var(--contract-border);
      background: var(--contract-bg);
      color: var(--text-color);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .tool-tab:hover {
      border-color: var(--accent-color);
    }

    .tool-tab.active {
      background: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }

    /* Global API Key Section */
    .global-api-section {
      background: linear-gradient(135deg, rgba(123, 63, 228, 0.15), rgba(123, 63, 228, 0.05));
      border: 2px solid var(--accent-color);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .global-api-section h3 {
      margin-bottom: 15px;
      color: var(--accent-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .api-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .api-status.connected {
      background: rgba(34, 197, 94, 0.2);
      color: var(--success-color);
    }

    .api-status.disconnected {
      background: rgba(239, 68, 68, 0.2);
      color: var(--error-color);
    }

    .api-status .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
    }

    @media (max-width: 768px) {
      .trade-card {
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }

      .trade-card .trade-time {
        grid-column: span 2;
        text-align: left;
      }

      .pool-card .pool-stats {
        grid-template-columns: 1fr;
      }
    }

    /* Dashboard Styles */
    .dashboard-header {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 20px;
      background: var(--card-bg);
      border-radius: 12px;
      margin-bottom: 20px;
      border: 1px solid var(--contract-border);
    }

    .dashboard-header .token-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--accent-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .dashboard-header .token-info h3 {
      font-size: 1.4rem;
      margin-bottom: 4px;
    }

    .dashboard-header .token-info .token-ca {
      font-size: 0.8rem;
      color: var(--text-secondary);
      font-family: monospace;
    }

    .dashboard-header .token-price {
      margin-left: auto;
      text-align: right;
    }

    .dashboard-header .token-price .price {
      font-size: 1.6rem;
      font-weight: 700;
    }

    .dashboard-header .token-price .change {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .dashboard-header .token-price .change.positive {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .dashboard-header .token-price .change.negative {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--contract-border);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .stat-card .stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-card .stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--text-color);
    }

    .dashboard-intervals {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
    }

    .interval-card {
      background: var(--card-bg);
      border: 1px solid var(--contract-border);
      border-radius: 12px;
      padding: 15px;
    }

    .interval-card .interval-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--contract-border);
    }

    .interval-card .interval-label {
      font-weight: 700;
      font-size: 1rem;
      color: var(--accent-color);
    }

    .interval-card .interval-change {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .interval-card .interval-change.positive {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
    }

    .interval-card .interval-change.negative {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    .interval-card .interval-stats {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .interval-card .interval-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .interval-card .interval-row .label {
      color: var(--text-secondary);
    }

    .interval-card .interval-row .value {
      font-weight: 600;
    }

    .interval-card .interval-row .value.buy {
      color: #22c55e;
    }

    .interval-card .interval-row .value.sell {
      color: #ef4444;
    }

    .buy-sell-bar {
      height: 6px;
      background: #ef4444;
      border-radius: 3px;
      margin-top: 10px;
      overflow: hidden;
    }

    .buy-sell-bar .buy-portion {
      height: 100%;
      background: #22c55e;
      border-radius: 3px 0 0 3px;
    }

    @media (max-width: 900px) {
      .dashboard-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      .dashboard-intervals {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 500px) {
      .dashboard-stats {
        grid-template-columns: 1fr;
      }
      .dashboard-intervals {
        grid-template-columns: 1fr;
      }
      .dashboard-header {
        flex-direction: column;
        text-align: center;
      }
      .dashboard-header .token-price {
        margin-left: 0;
        margin-top: 15px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Price Ticker Header -->
  <div class="price-ticker">
    <span class="token-name">$EMO</span>
    <span class="price" id="tokenPrice">Loading...</span>
    <span class="change" id="priceChange">--</span>
    <span class="mcap" id="marketCap"></span>
    
    <!-- Audio Player -->
    <div class="audio-player" id="audioPlayer">
      <button class="player-btn" id="prevBtn">‚èÆ</button>
      <button class="player-btn play-btn" id="playBtn">‚ñ∂</button>
      <button class="player-btn" id="nextBtn">‚è≠</button>
      <button class="player-btn" id="muteBtn">üîä</button>
      <a href="emonad.mp3" download="Emonad.mp3" class="player-btn download-btn" title="Download">‚Üì</a>
    </div>
    
    <a href="emo.html" class="back-btn">‚Üê Back</a>
    
    <!-- Dark Mode Toggle -->
    <button class="theme-toggle-header" id="themeToggle" title="Toggle dark mode">
      <span class="icon-sun">‚óê</span>
      <span class="icon-moon">‚óë</span>
    </button>
  </div>
  
  <audio id="themeAudio" src="emonad.mp3" loop></audio>

  <div class="container">
    <!-- Page Title -->
    <div class="page-title">
      <h1><span>$EMO</span> Tools</h1>
      <p>Utilities for Monad meme coin holders & builders</p>
    </div>

    <!-- Global API Key Section -->
    <div class="global-api-section">
      <h3>üîê BlockVision API Key <span class="api-status disconnected" id="apiStatus"><span class="status-dot"></span> Not Set</span></h3>
      <div class="form-group" style="margin-bottom: 10px;">
        <input type="password" class="input-field" id="globalApiKey" placeholder="Enter your BlockVision API key">
      </div>
      <p class="hint" style="margin: 0;">Your key stays in your browser only. Get a free key at <a href="https://dashboard.blockvision.org/overview" target="_blank">BlockVision Dashboard</a> (10M free compute units).</p>
    </div>

    <!-- Tool 1: Token Holder Snapshot -->
    <div class="tool-card" id="tool-snapshot">
      <div class="tool-header" onclick="toggleTool('tool-snapshot')">
        <div class="tool-icon">üì∏</div>
        <div class="tool-title">
          <h2>Token Holder Snapshot</h2>
          <p>Get top holders of any Monad token instantly</p>
        </div>
        <span class="toggle-icon">‚ñº</span>
      </div>
      <div class="tool-content">
        <div class="input-row">
          <div class="form-group">
            <label>Token Contract Address</label>
            <input type="text" class="input-field" id="snapshotTokenAddress" placeholder="0x..." value="0x81A224F8A62f52BdE942dBF23A56df77A10b7777">
          </div>
          <div class="form-group small">
            <label>Top Holders</label>
            <input type="number" class="input-field" id="snapshotTopCount" value="50" min="1" max="500">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="fetchHolders()">üì∏ Take Snapshot</button>
          <button class="btn secondary" id="exportCsvBtn" onclick="exportSnapshotCSV()" style="display: none;">üì• CSV</button>
          <button class="btn secondary" id="exportJsonBtn" onclick="exportSnapshotJSON()" style="display: none;">üì• JSON</button>
          <button class="btn secondary" id="exportTxtBtn" onclick="exportSnapshotTXT()" style="display: none;">üì• TXT</button>
          <button class="btn secondary" id="copyAddressesBtn" onclick="copySnapshotAddresses()" style="display: none;">üìã Copy All</button>
        </div>
        <div class="status" id="snapshotStatus"></div>
        <div class="results-area" id="snapshotResults">
          <div class="results-header">
            <h3 id="snapshotTokenName">Token Holders</h3>
            <div class="results-stats">
              <span id="snapshotTotalHolders">0 holders</span>
              <span id="snapshotTime"></span>
            </div>
          </div>
          <div class="results-container">
            <table class="results-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Address</th>
                  <th class="amount">Amount</th>
                  <th class="percentage">%</th>
                </tr>
              </thead>
              <tbody id="snapshotTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Tool 2: Wallet Checker -->
    <div class="tool-card collapsed" id="tool-wallet">
      <div class="tool-header" onclick="toggleTool('tool-wallet')">
        <div class="tool-icon">üëõ</div>
        <div class="tool-title">
          <h2>Wallet Checker</h2>
          <p>View all tokens & NFTs held by any wallet</p>
        </div>
        <span class="toggle-icon">‚ñº</span>
      </div>
      <div class="tool-content">
        <div class="form-group">
          <label>Wallet Address</label>
          <input type="text" class="input-field" id="walletAddress" placeholder="0x...">
        </div>
        <div class="btn-group">
          <button class="btn" onclick="checkWallet()">üëõ Check Wallet</button>
          <button class="btn secondary" id="exportWalletCsvBtn" onclick="exportWalletCSV()" style="display: none;">üì• CSV</button>
          <button class="btn secondary" id="copyWalletBtn" onclick="copyWalletAddress()" style="display: none;">üìã Copy</button>
        </div>
        <div class="status" id="walletStatus"></div>
        <div class="results-area" id="walletResults">
          <div class="results-header">
            <h3>Token Holdings</h3>
            <div class="results-stats">
              <span id="walletTotalTokens">0 tokens</span>
              <span id="walletTotalValue"></span>
            </div>
          </div>
          <div id="walletTokenList"></div>
          
          <!-- NFT Holdings Section -->
          <div class="results-header" id="walletNftHeader" style="margin-top: 20px; display: none;">
            <h3>üñºÔ∏è NFT Holdings</h3>
            <div class="results-stats">
              <span id="walletTotalNfts">0 NFTs</span>
            </div>
          </div>
          <div id="walletNftList"></div>
        </div>
      </div>
    </div>

    <!-- Tool 3: Whale Watcher -->
    <div class="tool-card collapsed" id="tool-whale">
      <div class="tool-header" onclick="toggleTool('tool-whale')">
        <div class="tool-icon">üêã</div>
        <div class="tool-title">
          <h2>Whale Watcher</h2>
          <p>See what top holders are also holding</p>
        </div>
        <span class="toggle-icon">‚ñº</span>
      </div>
      <div class="tool-content">
        <div class="input-row">
          <div class="form-group">
            <label>Token Contract Address</label>
            <input type="text" class="input-field" id="whaleTokenAddress" placeholder="0x..." value="0x81A224F8A62f52BdE942dBF23A56df77A10b7777">
          </div>
          <div class="form-group small">
            <label>Top Whales</label>
            <input type="number" class="input-field" id="whaleCount" value="10" min="1" max="50">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="watchWhales()">üêã Analyze Whales</button>
          <button class="btn secondary" id="exportWhaleCsvBtn" onclick="exportWhaleCSV()" style="display: none;">üì• CSV</button>
          <button class="btn secondary" id="exportWhaleTxtBtn" onclick="exportWhaleTXT()" style="display: none;">üì• TXT</button>
        </div>
        <div class="status" id="whaleStatus"></div>
        <div class="results-area" id="whaleResults">
          <div class="results-header">
            <h3>Whale Holdings</h3>
          </div>
          <div id="whaleList"></div>
        </div>
      </div>
    </div>

    <!-- Tool 4: NFT Holder Snapshot -->
    <div class="tool-card collapsed" id="tool-nft">
      <div class="tool-header" onclick="toggleTool('tool-nft')">
        <div class="tool-icon">üñºÔ∏è</div>
        <div class="tool-title">
          <h2>NFT Holder Snapshot</h2>
          <p>Get holders of any Monad NFT collection</p>
        </div>
        <span class="toggle-icon">‚ñº</span>
      </div>
      <div class="tool-content">
        <!-- Find NFT Contract Address -->
        <div class="api-notice" style="margin-bottom: 20px;">
          <span class="notice-icon">üí°</span>
          <div class="notice-text">
            <strong>Need the contract address?</strong> Browse all Monad NFT collections on MonadVision to find and copy the contract address.
            <div style="margin-top: 10px;">
              <a href="https://monadvision.com/nfts" target="_blank" class="btn" style="display: inline-flex; padding: 8px 16px; text-decoration: none; font-size: 14px;">
                üîç Browse NFT Collections on MonadVision
              </a>
            </div>
          </div>
        </div>

        <!-- Direct Address Input -->
        <div class="input-row">
          <div class="form-group">
            <label>NFT Contract Address</label>
            <input type="text" class="input-field" id="nftAddress" placeholder="0x...">
          </div>
          <div class="form-group small">
            <label>Top Holders</label>
            <input type="number" class="input-field" id="nftTopCount" value="50" min="1" max="500">
          </div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="fetchNFTHolders()">üñºÔ∏è Take Snapshot</button>
          <button class="btn secondary" id="exportNftCsvBtn" onclick="exportNFTCSV()" style="display: none;">üì• CSV</button>
          <button class="btn secondary" id="exportNftTxtBtn" onclick="exportNFTTXT()" style="display: none;">üì• TXT</button>
          <button class="btn secondary" id="copyNftAddressesBtn" onclick="copyNFTAddresses()" style="display: none;">üìã Copy All</button>
        </div>
        <div class="status" id="nftStatus"></div>
        <div class="results-area" id="nftResults">
          <div class="results-header">
            <h3 id="nftCollectionTitle">NFT Holders</h3>
            <div class="results-stats">
              <span id="nftTotalHolders">0 holders</span>
              <span id="nftTotalSupply"></span>
            </div>
          </div>
          <div class="results-container">
            <table class="results-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Address</th>
                  <th class="amount">NFTs Held</th>
                  <th class="percentage">%</th>
                </tr>
              </thead>
              <tbody id="nftTable"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ==================== GLOBAL STATE ====================
    let snapshotData = [];
    let nftData = [];
    let whaleData = [];
    let walletTokenData = [];
    let walletNftData = [];

    // ==================== PRICE TICKER ====================
    async function fetchPrice() {
      try {
        const response = await fetch('https://api.dexscreener.com/latest/dex/pairs/monad/0x714a2694c8d4f0b1bfba0e5b76240e439df2182d');
        const data = await response.json();
        if (data.pair) {
          const price = parseFloat(data.pair.priceUsd);
          const change24h = parseFloat(data.pair.priceChange.h24);
          const mcap = data.pair.marketCap;
          
          document.getElementById('tokenPrice').textContent = '$' + price.toFixed(7);
          
          const changeEl = document.getElementById('priceChange');
          changeEl.textContent = (change24h >= 0 ? '+' : '') + change24h.toFixed(2) + '%';
          changeEl.className = 'change ' + (change24h >= 0 ? 'positive' : 'negative');
          
          if (mcap) {
            const mcapFormatted = mcap >= 1000000 ? (mcap / 1000000).toFixed(2) + 'M' : (mcap / 1000).toFixed(1) + 'K';
            document.getElementById('marketCap').textContent = 'MC: $' + mcapFormatted;
          }
        }
      } catch (error) {
        console.log('Price fetch error:', error);
        document.getElementById('tokenPrice').textContent = '--';
      }
    }
    
    fetchPrice();
    setInterval(fetchPrice, 30000);

    // ==================== AUDIO PLAYER ====================
    const audio = document.getElementById('themeAudio');
    const playBtn = document.getElementById('playBtn');
    const muteBtn = document.getElementById('muteBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    let isPlaying = false;

    playBtn.addEventListener('click', () => {
      if (isPlaying) {
        audio.pause();
        playBtn.textContent = '‚ñ∂';
        isPlaying = false;
      } else {
        audio.play();
        playBtn.textContent = '‚è∏';
        isPlaying = true;
      }
    });

    muteBtn.addEventListener('click', () => {
      audio.muted = !audio.muted;
      muteBtn.textContent = audio.muted ? 'üîá' : 'üîä';
    });

    prevBtn.addEventListener('click', () => {
      audio.currentTime = Math.max(0, audio.currentTime - 10);
    });

    nextBtn.addEventListener('click', () => {
      audio.currentTime = Math.min(audio.duration, audio.currentTime + 10);
    });

    // ==================== THEME TOGGLE ====================
    const themeToggle = document.getElementById('themeToggle');
    themeToggle.addEventListener('click', () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });

    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);

    // ==================== API KEY MANAGEMENT ====================
    const apiKeyInput = document.getElementById('globalApiKey');
    const apiStatus = document.getElementById('apiStatus');

    // Load saved API key
    const savedApiKey = localStorage.getItem('blockvision_api_key');
    if (savedApiKey) {
      apiKeyInput.value = savedApiKey;
      updateApiStatus(true);
    }

    apiKeyInput.addEventListener('input', () => {
      const key = apiKeyInput.value.trim();
      if (key) {
        localStorage.setItem('blockvision_api_key', key);
        updateApiStatus(true);
      } else {
        localStorage.removeItem('blockvision_api_key');
        updateApiStatus(false);
      }
    });

    function updateApiStatus(connected) {
      if (connected) {
        apiStatus.className = 'api-status connected';
        apiStatus.innerHTML = '<span class="status-dot"></span> Connected';
      } else {
        apiStatus.className = 'api-status disconnected';
        apiStatus.innerHTML = '<span class="status-dot"></span> Not Set';
      }
    }

    function getApiKey() {
      return apiKeyInput.value.trim();
    }

    // ==================== TOOL TOGGLE ====================
    function toggleTool(toolId) {
      const tool = document.getElementById(toolId);
      tool.classList.toggle('collapsed');
    }

    // ==================== UTILITY FUNCTIONS ====================
    function showStatus(elementId, message, type) {
      const status = document.getElementById(elementId);
      status.textContent = message;
      status.className = `status active ${type}`;
    }

    function hideStatus(elementId) {
      const status = document.getElementById(elementId);
      status.className = 'status';
    }

    function downloadFile(content, filename, type) {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function validateAddress(address) {
      return address && address.startsWith('0x') && address.length === 42;
    }

    function formatNumber(num) {
      return parseFloat(num || 0).toLocaleString(undefined, {maximumFractionDigits: 2});
    }

    function formatUSD(num) {
      return '$' + parseFloat(num || 0).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

    function timeAgo(timestamp) {
      const seconds = Math.floor((Date.now() - timestamp * 1000) / 1000);
      if (seconds < 60) return `${seconds}s ago`;
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
      return `${Math.floor(seconds / 86400)}d ago`;
    }

    async function apiCall(endpoint, params = {}) {
      const apiKey = getApiKey();
      if (!apiKey) throw new Error('Please enter your BlockVision API key');

      const url = new URL(`https://api.blockvision.org/v2/monad/${endpoint}`);
      Object.keys(params).forEach(key => {
        if (params[key]) url.searchParams.append(key, params[key]);
      });

      const response = await fetch(url, {
        headers: { 'X-API-Key': apiKey, 'Accept': 'application/json' }
      });

      if (!response.ok) {
        if (response.status === 401) throw new Error('Invalid API key');
        if (response.status === 429) throw new Error('Rate limit exceeded. Wait and try again.');
        throw new Error(`API error: ${response.status}`);
      }

      const data = await response.json();
      if (data.code !== 0) throw new Error(data.reason || 'API error');
      return data.result;
    }

    // ==================== TOOL 1: TOKEN HOLDER SNAPSHOT ====================
    let snapshotTokenName = '';
    let snapshotTokenSymbol = '';

    async function fetchHolders() {
      const tokenAddress = document.getElementById('snapshotTokenAddress').value.trim();
      const topCount = parseInt(document.getElementById('snapshotTopCount').value) || 50;

      if (!validateAddress(tokenAddress)) {
        showStatus('snapshotStatus', 'Invalid token address', 'error');
        return;
      }

      showStatus('snapshotStatus', 'Fetching token info...', 'loading');
      snapshotData = [];
      snapshotTokenName = '';
      snapshotTokenSymbol = '';
      let cursor = '';
      let page = 1;

      try {
        // Get token name first
        try {
          const contractInfo = await apiCall('contract/detail', { contractAddress: tokenAddress });
          if (contractInfo) {
            snapshotTokenName = contractInfo.token?.name || contractInfo.contractMeta?.contractName || '';
            snapshotTokenSymbol = contractInfo.token?.symbol || '';
          }
        } catch (e) {}

        showStatus('snapshotStatus', 'Fetching holders...', 'loading');

        while (snapshotData.length < topCount) {
          const result = await apiCall('token/holders', {
            contractAddress: tokenAddress,
            limit: Math.min(50, topCount - snapshotData.length),
            cursor: cursor || undefined
          });

          const holders = result.data || [];
          if (holders.length === 0) break;

          snapshotData.push(...holders);
          showStatus('snapshotStatus', `Fetching... Page ${page} (${snapshotData.length} holders)`, 'loading');

          cursor = result.nextPageCursor || '';
          if (!cursor) break;
          page++;
        }

        snapshotData = snapshotData.slice(0, topCount);

        if (snapshotData.length === 0) {
          showStatus('snapshotStatus', 'No holders found', 'error');
          return;
        }

        // Display results with contract icon for contract addresses
        const tbody = document.getElementById('snapshotTable');
        tbody.innerHTML = snapshotData.map((h, i) => {
          const isContract = h.isContract || false;
          const icon = isContract ? '<span title="Contract">üìÑ</span> ' : '';
          return `
            <tr>
              <td>${i + 1}</td>
              <td class="address" title="${h.holder}">${icon}${h.holder}</td>
              <td class="amount">${formatNumber(h.amount)}</td>
              <td class="percentage">${parseFloat(h.percentage || 0).toFixed(2)}%</td>
            </tr>
          `;
        }).join('');

        document.getElementById('snapshotResults').classList.add('active');
        
        // Show token name in header
        const tokenLabel = snapshotTokenSymbol ? `${snapshotTokenName} ($${snapshotTokenSymbol})` : (snapshotTokenName || 'Token');
        document.getElementById('snapshotTokenName').innerHTML = `<span style="color: var(--accent-color);">${tokenLabel}</span> Holders`;
        
        document.getElementById('snapshotTotalHolders').textContent = `${snapshotData.length} holders`;
        document.getElementById('snapshotTime').textContent = new Date().toLocaleString();
        document.getElementById('exportCsvBtn').style.display = 'inline-flex';
        document.getElementById('exportJsonBtn').style.display = 'inline-flex';
        document.getElementById('exportTxtBtn').style.display = 'inline-flex';
        document.getElementById('copyAddressesBtn').style.display = 'inline-flex';

        const successMsg = snapshotTokenSymbol ? `Found ${snapshotData.length} holders of $${snapshotTokenSymbol}!` : `Fetched ${snapshotData.length} holders!`;
        showStatus('snapshotStatus', successMsg, 'success');
      } catch (error) {
        showStatus('snapshotStatus', error.message, 'error');
      }
    }

    function copySnapshotAddresses() {
      if (snapshotData.length === 0) return;
      const addresses = snapshotData.map(h => h.holder).join('\n');
      navigator.clipboard.writeText(addresses).then(() => {
        showStatus('snapshotStatus', `Copied ${snapshotData.length} addresses to clipboard!`, 'success');
      }).catch(() => {
        showStatus('snapshotStatus', 'Failed to copy to clipboard', 'error');
      });
    }

    function exportSnapshotCSV() {
      if (snapshotData.length === 0) return;
      const tokenAddress = document.getElementById('snapshotTokenAddress').value.trim();
      let csv = 'Rank,Address,Amount,Percentage\n';
      snapshotData.forEach((h, i) => {
        csv += `${i + 1},${h.holder},${h.amount},${h.percentage}\n`;
      });
      downloadFile(csv, `${tokenAddress.slice(0, 10)}_holders.csv`, 'text/csv');
    }

    function exportSnapshotJSON() {
      if (snapshotData.length === 0) return;
      const tokenAddress = document.getElementById('snapshotTokenAddress').value.trim();
      const output = {
        token: tokenAddress,
        timestamp: new Date().toISOString(),
        holders: snapshotData.map((h, i) => ({ rank: i + 1, address: h.holder, amount: h.amount, percentage: h.percentage }))
      };
      downloadFile(JSON.stringify(output, null, 2), `${tokenAddress.slice(0, 10)}_holders.json`, 'application/json');
    }

    function exportSnapshotTXT() {
      if (snapshotData.length === 0) return;
      const tokenAddress = document.getElementById('snapshotTokenAddress').value.trim();
      const txt = snapshotData.map(h => h.holder).join('\n');
      downloadFile(txt, `${tokenAddress.slice(0, 10)}_wallets.txt`, 'text/plain');
    }

    // ==================== TOOL 2: WALLET CHECKER ====================
    async function checkWallet() {
      const walletAddress = document.getElementById('walletAddress').value.trim();

      if (!validateAddress(walletAddress)) {
        showStatus('walletStatus', 'Invalid wallet address', 'error');
        return;
      }

      showStatus('walletStatus', 'Fetching wallet tokens...', 'loading');
      walletTokenData = [];
      walletNftData = [];

      try {
        const result = await apiCall('account/tokens', { address: walletAddress });
        const tokens = result.data || [];
        walletTokenData = tokens;

        const tokenList = document.getElementById('walletTokenList');
        let totalValue = 0;

        if (tokens.length > 0) {
          tokenList.innerHTML = tokens.map(t => {
            const value = parseFloat(t.usdValue || 0);
            totalValue += value;
            return `
              <div class="token-card">
                <div class="token-info">
                  <span class="token-name">${t.symbol || 'Unknown'}</span>
                  <span class="token-address">${t.contractAddress}</span>
                </div>
                <div class="token-balance">
                  <div class="token-amount">${formatNumber(t.balance)}</div>
                  ${value > 0 ? `<div class="token-value">${formatUSD(value)}</div>` : ''}
                </div>
              </div>
            `;
          }).join('');
        } else {
          tokenList.innerHTML = '<div style="color: var(--text-secondary); padding: 10px;">No tokens found</div>';
        }

        document.getElementById('walletTotalTokens').textContent = `${tokens.length} tokens`;
        document.getElementById('walletTotalValue').textContent = totalValue > 0 ? `Total: ${formatUSD(totalValue)}` : '';

        // Fetch NFTs
        showStatus('walletStatus', 'Fetching NFTs...', 'loading');
        try {
          const nftResult = await apiCall('account/nfts', { address: walletAddress });
          const nfts = nftResult.data || [];
          walletNftData = nfts;

          if (nfts.length > 0) {
            document.getElementById('walletNftHeader').style.display = 'flex';
            document.getElementById('walletTotalNfts').textContent = `${nfts.length} NFTs`;
            
            document.getElementById('walletNftList').innerHTML = nfts.map(n => `
              <div class="token-card">
                <div class="token-info">
                  <span class="token-name">üñºÔ∏è ${n.collectionName || n.name || 'Unknown NFT'}</span>
                  <span class="token-address">${n.contractAddress}</span>
                </div>
                <div class="token-balance">
                  <div class="token-amount">${n.tokenId ? `#${n.tokenId}` : `${n.amount || 1}x`}</div>
                </div>
              </div>
            `).join('');
          } else {
            document.getElementById('walletNftHeader').style.display = 'none';
            document.getElementById('walletNftList').innerHTML = '';
          }
        } catch (e) {
          // NFT fetch failed, just skip
          document.getElementById('walletNftHeader').style.display = 'none';
        }

        document.getElementById('walletResults').classList.add('active');
        document.getElementById('exportWalletCsvBtn').style.display = 'inline-flex';
        document.getElementById('copyWalletBtn').style.display = 'inline-flex';

        const totalItems = tokens.length + walletNftData.length;
        showStatus('walletStatus', `Found ${tokens.length} tokens${walletNftData.length > 0 ? ` and ${walletNftData.length} NFTs` : ''}!`, 'success');
      } catch (error) {
        showStatus('walletStatus', error.message, 'error');
      }
    }

    function exportWalletCSV() {
      if (walletTokenData.length === 0 && walletNftData.length === 0) return;
      const walletAddress = document.getElementById('walletAddress').value.trim();
      let csv = 'Type,Name,Contract,Amount,Value\n';
      walletTokenData.forEach(t => {
        csv += `Token,${t.symbol || 'Unknown'},${t.contractAddress},${t.balance},${t.usdValue || 0}\n`;
      });
      walletNftData.forEach(n => {
        csv += `NFT,${n.collectionName || n.name || 'Unknown'},${n.contractAddress},${n.amount || 1},\n`;
      });
      downloadFile(csv, `${walletAddress.slice(0, 10)}_holdings.csv`, 'text/csv');
    }

    function copyWalletAddress() {
      const walletAddress = document.getElementById('walletAddress').value.trim();
      navigator.clipboard.writeText(walletAddress).then(() => {
        showStatus('walletStatus', 'Wallet address copied!', 'success');
      }).catch(() => {
        showStatus('walletStatus', 'Failed to copy', 'error');
      });
    }

    // ==================== TOOL 3: WHALE WATCHER ====================
    async function watchWhales() {
      const tokenAddress = document.getElementById('whaleTokenAddress').value.trim();
      const whaleCount = parseInt(document.getElementById('whaleCount').value) || 10;

      if (!validateAddress(tokenAddress)) {
        showStatus('whaleStatus', 'Invalid token address', 'error');
        return;
      }

      showStatus('whaleStatus', 'Fetching top holders...', 'loading');

      try {
        // First get top holders
        const holdersResult = await apiCall('token/holders', {
          contractAddress: tokenAddress,
          limit: whaleCount
        });

        const holders = holdersResult.data || [];
        if (holders.length === 0) {
          showStatus('whaleStatus', 'No holders found', 'error');
          return;
        }

        whaleData = [];
        const whaleList = document.getElementById('whaleList');
        whaleList.innerHTML = '';
        
        // Track common holdings across whales
        const tokenCounts = {};

        // For each whale, get their other holdings
        for (let i = 0; i < holders.length; i++) {
          const whale = holders[i];
          showStatus('whaleStatus', `Analyzing whale ${i + 1}/${holders.length}...`, 'loading');

          try {
            const tokensResult = await apiCall('account/tokens', { address: whale.holder });
            const otherTokens = (tokensResult.data || []).filter(t => 
              t.contractAddress.toLowerCase() !== tokenAddress.toLowerCase()
            ).slice(0, 5);

            // Count token occurrences for common holdings
            otherTokens.forEach(t => {
              const key = t.contractAddress.toLowerCase();
              if (!tokenCounts[key]) {
                tokenCounts[key] = { symbol: t.symbol || 'Unknown', count: 0, contract: t.contractAddress };
              }
              tokenCounts[key].count++;
            });

            whaleData.push({ ...whale, otherTokens });

            const isContract = whale.isContract || false;
            const icon = isContract ? '<span title="Contract">üìÑ</span> ' : '';

            whaleList.innerHTML += `
              <div class="token-card" style="flex-direction: column; align-items: stretch;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                  <div>
                    <strong>#${i + 1}</strong>
                    <span class="token-address" style="margin-left: 10px;">${icon}${whale.holder}</span>
                  </div>
                  <div>
                    <span class="token-amount">${formatNumber(whale.amount)}</span>
                    <span style="color: var(--text-secondary);"> (${parseFloat(whale.percentage).toFixed(2)}%)</span>
                  </div>
                </div>
                ${otherTokens.length > 0 ? `
                  <div style="font-size: 0.85rem; color: var(--text-secondary);">
                    Also holds: ${otherTokens.map(t => `<span style="color: var(--accent-color);">${t.symbol || 'Unknown'}</span>`).join(', ')}
                  </div>
                ` : '<div style="font-size: 0.85rem; color: var(--text-secondary);">No other tokens found</div>'}
              </div>
            `;
          } catch (e) {
            // Skip if we can't get this whale's tokens
            whaleData.push({ ...whale, otherTokens: [] });
          }
        }

        // Show common holdings analysis
        const commonTokens = Object.values(tokenCounts)
          .filter(t => t.count >= 2)
          .sort((a, b) => b.count - a.count)
          .slice(0, 5);

        if (commonTokens.length > 0) {
          const commonHtml = `
            <div class="token-card" style="background: rgba(123, 63, 228, 0.1); border-color: var(--accent-color);">
              <div style="width: 100%;">
                <div style="font-weight: 700; margin-bottom: 8px; color: var(--accent-color);">üî• Common Holdings</div>
                <div style="font-size: 0.9rem;">
                  ${commonTokens.map(t => `<span style="margin-right: 15px;"><strong>${t.symbol}</strong> <span style="color: var(--text-secondary);">(${t.count} whales)</span></span>`).join('')}
                </div>
              </div>
            </div>
          `;
          whaleList.insertAdjacentHTML('afterbegin', commonHtml);
        }

        document.getElementById('whaleResults').classList.add('active');
        document.getElementById('exportWhaleCsvBtn').style.display = 'inline-flex';
        document.getElementById('exportWhaleTxtBtn').style.display = 'inline-flex';
        showStatus('whaleStatus', `Analyzed ${holders.length} whales!`, 'success');
      } catch (error) {
        showStatus('whaleStatus', error.message, 'error');
      }
    }

    function exportWhaleCSV() {
      if (whaleData.length === 0) return;
      const tokenAddress = document.getElementById('whaleTokenAddress').value.trim();
      let csv = 'Rank,Address,Amount,Percentage,Other Holdings\n';
      whaleData.forEach((w, i) => {
        const otherHoldings = w.otherTokens ? w.otherTokens.map(t => t.symbol || 'Unknown').join('; ') : '';
        csv += `${i + 1},${w.holder},${w.amount},${w.percentage},"${otherHoldings}"\n`;
      });
      downloadFile(csv, `${tokenAddress.slice(0, 10)}_whales.csv`, 'text/csv');
    }

    function exportWhaleTXT() {
      if (whaleData.length === 0) return;
      const tokenAddress = document.getElementById('whaleTokenAddress').value.trim();
      const txt = whaleData.map(w => w.holder).join('\n');
      downloadFile(txt, `${tokenAddress.slice(0, 10)}_whale_wallets.txt`, 'text/plain');
    }

    // ==================== TOOL 4: NFT HOLDER SNAPSHOT ====================

    function exportNFTTXT() {
      if (nftData.length === 0) return;
      const nftAddress = document.getElementById('nftAddress').value.trim();
      const txt = nftData.map(h => h.ownerAddress || h.holder || h.address).join('\n');
      downloadFile(txt, `${nftAddress.slice(0, 10)}_nft_wallets.txt`, 'text/plain');
    }
    let nftCollectionName = '';

    async function fetchNFTHolders() {
      const nftAddress = document.getElementById('nftAddress').value.trim();
      const topCount = parseInt(document.getElementById('nftTopCount').value) || 50;

      if (!validateAddress(nftAddress)) {
        showStatus('nftStatus', 'Invalid NFT contract address', 'error');
        return;
      }

      showStatus('nftStatus', 'Fetching NFT collection info...', 'loading');
      nftData = [];
      nftCollectionName = '';

      try {
        // First, try to get the collection name from contract detail
        try {
          const contractInfo = await apiCall('contract/detail', { contractAddress: nftAddress });
          if (contractInfo) {
            nftCollectionName = contractInfo.nft?.name || contractInfo.contractMeta?.contractName || contractInfo.token?.name || '';
          }
        } catch (e) {
          // Continue without name if this fails
        }

        showStatus('nftStatus', 'Fetching NFT holders...', 'loading');

        // Try multiple possible endpoint paths
        const endpoints = ['nft/collection/holders', 'collection/holders', 'nft/holders'];
        let workingEndpoint = null;
        let result = null;
        let lastError = null;

        for (const endpoint of endpoints) {
          try {
            result = await apiCall(endpoint, {
              contractAddress: nftAddress,
              limit: Math.min(50, topCount)
            });
            if (result && result.data) {
              workingEndpoint = endpoint;
              break;
            }
          } catch (e) {
            lastError = e;
            continue;
          }
        }

        if (!result || !result.data) {
          throw lastError || new Error('Could not fetch NFT holders');
        }

        // Process first page
        nftData.push(...(result.data || []));
        let nextCursor = result.nextPageCursor || '';

        // Fetch remaining pages
        while (nftData.length < topCount && nextCursor) {
          showStatus('nftStatus', `Fetching... (${nftData.length} holders)`, 'loading');
          
          result = await apiCall(workingEndpoint, {
            contractAddress: nftAddress,
            limit: Math.min(50, topCount - nftData.length),
            cursor: nextCursor
          });

          const pageHolders = result.data || [];
          if (pageHolders.length === 0) break;

          nftData.push(...pageHolders);
          nextCursor = result.nextPageCursor || '';
        }

        nftData = nftData.slice(0, topCount);

        if (nftData.length === 0) {
          showStatus('nftStatus', 'No holders found. This collection may not be indexed yet.', 'error');
          return;
        }

        const tbody = document.getElementById('nftTable');
        const totalNFTs = nftData.reduce((sum, h) => sum + parseInt(h.amount || h.tokenCount || 1), 0);

        tbody.innerHTML = nftData.map((h, i) => {
          const count = parseInt(h.amount || h.tokenCount || 1);
          const pct = h.percentage || ((count / totalNFTs) * 100).toFixed(2);
          const addr = h.ownerAddress || h.holder || h.address;
          return `
            <tr>
              <td>${i + 1}</td>
              <td class="address" title="${addr}">${addr}</td>
              <td class="amount">${count}</td>
              <td class="percentage">${parseFloat(pct).toFixed(2)}%</td>
            </tr>
          `;
        }).join('');

        document.getElementById('nftResults').classList.add('active');
        
        // Show collection name in title
        if (nftCollectionName) {
          document.getElementById('nftCollectionTitle').innerHTML = `<span style="color: var(--accent-color);">${nftCollectionName}</span> Holders`;
        } else {
          document.getElementById('nftCollectionTitle').textContent = 'NFT Holders';
        }
        
        document.getElementById('nftTotalHolders').textContent = `${nftData.length} holders`;
        document.getElementById('nftTotalSupply').textContent = `${totalNFTs} total NFTs`;
        
        document.getElementById('exportNftCsvBtn').style.display = 'inline-flex';
        document.getElementById('exportNftTxtBtn').style.display = 'inline-flex';
        document.getElementById('copyNftAddressesBtn').style.display = 'inline-flex';

        const successMsg = nftCollectionName ? `Found ${nftData.length} holders of ${nftCollectionName}!` : `Fetched ${nftData.length} holders!`;
        showStatus('nftStatus', successMsg, 'success');
      } catch (error) {
        // If collection/holders fails, the NFT may not be indexed yet
        if (error.message.includes('404')) {
          showStatus('nftStatus', 'This NFT collection is not indexed yet. Try again later or check the contract address.', 'error');
        } else {
          showStatus('nftStatus', error.message, 'error');
        }
      }
    }

    function exportNFTCSV() {
      if (nftData.length === 0) return;
      const nftAddress = document.getElementById('nftAddress').value.trim();
      let csv = 'Rank,Address,NFTs Held\n';
      nftData.forEach((h, i) => {
        const addr = h.ownerAddress || h.holder || h.address;
        csv += `${i + 1},${addr},${h.amount || h.tokenCount || 1}\n`;
      });
      downloadFile(csv, `${nftAddress.slice(0, 10)}_nft_holders.csv`, 'text/csv');
    }

    function copyNFTAddresses() {
      if (nftData.length === 0) return;
      const addresses = nftData.map(h => h.ownerAddress || h.holder || h.address).join('\n');
      navigator.clipboard.writeText(addresses).then(() => {
        showStatus('nftStatus', `Copied ${nftData.length} addresses to clipboard!`, 'success');
      }).catch(() => {
        showStatus('nftStatus', 'Failed to copy to clipboard', 'error');
      });
    }

  </script>
</body>
</html>
