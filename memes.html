<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Memes — $EMO</title>
  <meta name="description" content="$EMO meme gallery — the emo kid of Monad">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <style>
    @font-face {
      font-family: 'Space Grotesk';
      font-style: normal;
      font-weight: 500 800;
      font-display: swap;
      src: url(fonts/SpaceGrotesk-latin.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }
    :root {
      --bg-color: #ffffff;
      --text-color: #1a1a1a;
      --text-secondary: #666666;
      --text-muted: #aaaaaa;
      --accent: #7B3FE4;
      --accent-hover: #6930c3;
      --accent-glow: rgba(123, 63, 228, 0.25);
      --surface: #f5f3ff;
      --surface-border: #e4d8f8;
    }

    [data-theme="dark"] {
      --bg-color: #0a0a0a;
      --text-color: #ffffff;
      --text-secondary: #888888;
      --text-muted: #505050;
      --accent: #9B5FFF;
      --accent-hover: #b080ff;
      --accent-glow: rgba(155, 95, 255, 0.3);
      --surface: rgba(255, 255, 255, 0.06);
      --surface-border: rgba(255, 255, 255, 0.1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: radial-gradient(ellipse at 50% 0%, var(--accent-glow) 0%, transparent 55%), var(--bg-color);
      color: var(--text-color);
      font-family: 'Space Grotesk', sans-serif;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      line-height: 1.6;
    }

    /* ── Page Transition ── */
    .page-transition {
      position: fixed;
      inset: 0;
      z-index: 9999;
      pointer-events: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-transition .pt-overlay {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 50% 50%, rgba(155, 95, 255, 0.15) 0%, transparent 60%),
        var(--bg-color);
      transform: scaleY(1);
      transform-origin: top;
      animation: ptOverlayOut 1.1s 0.25s cubic-bezier(0.77, 0, 0.175, 1) forwards;
    }

    .page-transition .pt-logo {
      position: relative;
      z-index: 1;
      opacity: 1;
      transform: scale(1) rotate(0deg);
      animation: ptLogoOut 0.8s cubic-bezier(0.77, 0, 0.175, 1) forwards;
    }

    .page-transition .pt-logo svg {
      width: 80px;
      height: 80px;
      filter: drop-shadow(0 0 30px rgba(155, 95, 255, 0.6));
    }

    .page-transition .pt-glow {
      position: absolute;
      inset: -20px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(155, 95, 255, 0.3) 0%, transparent 70%);
      opacity: 0.6;
      animation: ptGlowOut 0.7s ease forwards;
    }

    @keyframes ptOverlayOut {
      0% { transform: scaleY(1); }
      100% { transform: scaleY(0); }
    }

    @keyframes ptLogoOut {
      0% { opacity: 1; transform: scale(1) rotate(0deg); }
      100% { opacity: 0; transform: scale(1.3) rotate(15deg); }
    }

    @keyframes ptGlowOut {
      0% { opacity: 0.6; transform: scale(1); }
      100% { opacity: 0; transform: scale(2); }
    }

    .page-enter {
      animation: ptPageEnter 1.1s 0.3s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    @keyframes ptPageEnter {
      0% { opacity: 0; transform: translateY(25px); filter: blur(3px); }
      100% { opacity: 1; transform: translateY(0); filter: blur(0); }
    }

    /* ── Exit transition (back to emo) ── */
    .page-transition.exit-active {
      pointer-events: all;
    }

    .page-transition.exit-active .pt-overlay {
      transform: scaleY(0);
      transform-origin: bottom;
      animation: ptOverlayIn 1.1s cubic-bezier(0.77, 0, 0.175, 1) forwards;
    }

    .page-transition.exit-active .pt-logo {
      opacity: 0;
      transform: scale(0.5) rotate(-30deg);
      animation: ptLogoIn 1.0s 0.45s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    .page-transition.exit-active .pt-glow {
      opacity: 0;
      animation: ptGlowPulse 1.1s 0.55s ease forwards;
    }

    @keyframes ptOverlayIn {
      0% { transform: scaleY(0); transform-origin: bottom; }
      100% { transform: scaleY(1); transform-origin: bottom; }
    }

    @keyframes ptLogoIn {
      0% { opacity: 0; transform: scale(0.5) rotate(-30deg); }
      60% { opacity: 1; transform: scale(1.08) rotate(5deg); }
      100% { opacity: 1; transform: scale(1) rotate(0deg); }
    }

    @keyframes ptGlowPulse {
      0% { opacity: 0; transform: scale(0.5); }
      50% { opacity: 1; transform: scale(1.2); }
      100% { opacity: 0.6; transform: scale(1); }
    }

    .page-transition.exit-active ~ .top-bar,
    .page-transition.exit-active ~ .container {
      animation: ptContentOut 0.95s cubic-bezier(0.77, 0, 0.175, 1) forwards;
    }

    @keyframes ptContentOut {
      0% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
      100% { opacity: 0; transform: translateY(-40px) scale(0.97); filter: blur(4px); }
    }

    @media (prefers-reduced-motion: reduce) {
      .page-transition { display: none; }
      .page-enter { animation: none; opacity: 1; }
    }

    /* ── Theme Transition ── */
    html.theme-transition,
    html.theme-transition *,
    html.theme-transition *::before,
    html.theme-transition *::after {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease !important;
    }

    /* ── Top Bar ── */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 52px;
      background: var(--surface);
      border-bottom: 1px solid var(--surface-border);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-color);
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      padding: 7px 16px;
      border-radius: 999px;
      border: 1px solid var(--surface-border);
      background: transparent;
      transition: all 0.25s ease;
    }

    .back-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-glow);
    }

    .back-btn:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .meme-count {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .theme-toggle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid var(--surface-border);
      background: var(--surface);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
      transition: all 0.25s ease;
      flex-shrink: 0;
      position: relative;
    }

    .theme-toggle:hover {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .theme-toggle:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .theme-toggle .icon-sun,
    .theme-toggle .icon-moon {
      position: absolute;
      transition: all 0.3s ease;
    }

    .theme-toggle .icon-sun { opacity: 0; transform: rotate(-90deg); }
    .theme-toggle .icon-moon { opacity: 1; transform: rotate(0deg); }
    [data-theme="dark"] .theme-toggle .icon-sun { opacity: 1; transform: rotate(0deg); }
    [data-theme="dark"] .theme-toggle .icon-moon { opacity: 0; transform: rotate(90deg); }

    /* ── Header ── */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 68px 16px 40px;
    }

    .header {
      text-align: center;
      padding: 12px 0 20px;
    }

    .header h1 {
      font-size: 2.2rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--accent), var(--text-color) 70%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 1rem;
      font-weight: 500;
    }

    /* ── Meme Grid ── */
    .meme-grid {
      column-count: 3;
      column-gap: 14px;
    }

    .meme-item {
      background: var(--surface);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.3s ease;
      cursor: pointer;
      break-inside: avoid;
      margin-bottom: 14px;
      display: inline-block;
      width: 100%;
      border: 1px solid var(--surface-border);
      position: relative;
    }

    .meme-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      border-color: var(--accent);
    }

    .meme-item:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .meme-item img,
    .meme-item video {
      width: 100%;
      height: auto;
      display: block;
      background: var(--surface);
    }

    /* Skeleton placeholder */
    .meme-item img[data-loading="true"] {
      min-height: 150px;
      background: linear-gradient(90deg, var(--surface) 25%, var(--accent-glow) 50%, var(--surface) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      to { background-position: -200% 0; }
    }

    /* Error state */
    .meme-item.error {
      display: none;
    }

    /* ── Lightbox ── */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.92);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .lightbox.active {
      opacity: 1;
      visibility: visible;
    }

    .lightbox-media {
      max-width: 90%;
      max-height: 85vh;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      transform: scale(0.95);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      user-select: none;
      -webkit-user-drag: none;
    }

    .lightbox.active .lightbox-media {
      transform: scale(1);
    }

    .lightbox-close {
      position: absolute;
      top: 16px;
      right: 16px;
      color: white;
      font-size: 28px;
      cursor: pointer;
      z-index: 1001;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      transition: all 0.2s ease;
      line-height: 1;
    }

    .lightbox-close:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    .lightbox-close:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: white;
      font-size: 22px;
      cursor: pointer;
      z-index: 1001;
      user-select: none;
      opacity: 0.7;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .lightbox-nav:hover {
      opacity: 1;
      background: var(--accent);
      border-color: var(--accent);
      transform: translateY(-50%) scale(1.1);
    }

    .lightbox-nav:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .lightbox-prev { left: 16px; }
    .lightbox-next { right: 16px; }

    .lightbox-bottom {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .lightbox-counter {
      color: rgba(255, 255, 255, 0.7);
      font-size: 13px;
      font-weight: 600;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .lightbox-download {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .lightbox-download:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .lightbox-download:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* ── Back to Top ── */
    .back-to-top {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 20px var(--accent-glow);
      opacity: 0;
      visibility: hidden;
      transform: translateY(10px);
      transition: all 0.3s ease;
      z-index: 50;
    }

    .back-to-top.visible {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .back-to-top:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }

    .back-to-top:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* ── Reduced Motion ── */
    @media (prefers-reduced-motion: reduce) {
      .meme-item:hover { transform: none; }
      .meme-item img[data-loading="true"] { animation: none; }
      .lightbox-media { transition: none; }
      .lightbox { transition: none; }
      .back-to-top { transition: none; }
    }

    /* ── Responsive ── */
    @media (max-width: 768px) {
      .top-bar {
        height: 46px;
        padding: 0 12px;
      }

      .back-btn {
        font-size: 12px;
        padding: 8px 14px;
        min-height: 44px;
      }

      .meme-count { font-size: 11px; }
      .theme-toggle { width: 30px; height: 30px; font-size: 14px; }

      .container { padding: 58px 10px 30px; }

      .header { padding: 8px 0 14px; }
      .header h1 { font-size: 1.6rem; }
      .header p { font-size: 0.85rem; }

      .meme-grid {
        column-count: 2;
        column-gap: 10px;
      }

      .meme-item {
        border-radius: 10px;
        margin-bottom: 10px;
      }

      .lightbox-close {
        top: 12px;
        right: 12px;
        width: 38px;
        height: 38px;
        font-size: 24px;
      }

      .lightbox-nav {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }

      .lightbox-prev { left: 10px; }
      .lightbox-next { right: 10px; }

      .lightbox-counter { font-size: 12px; padding: 6px 12px; }

      .back-to-top {
        bottom: 16px;
        right: 16px;
        width: 40px;
        height: 40px;
      }
    }

    @media (max-width: 380px) {
      .meme-grid {
        column-gap: 6px;
      }

      .meme-item {
        margin-bottom: 6px;
        border-radius: 8px;
      }

      .header h1 { font-size: 1.4rem; }

      .lightbox-nav {
        width: 34px;
        height: 34px;
        font-size: 14px;
      }

      .lightbox-prev { left: 6px; }
      .lightbox-next { right: 6px; }
    }
  </style>
</head>
<body>

  <!-- Page Entrance Transition -->
  <div class="page-transition" id="pageTransition" aria-hidden="true">
    <div class="pt-overlay"></div>
    <div class="pt-logo">
      <div class="pt-glow"></div>
      <svg viewBox="0 0 24 24"><path fill="#836EF9" d="M12 3c-2.599 0-9 6.4-9 9s6.401 9 9 9s9-6.401 9-9s-6.401-9-9-9m-1.402 14.146c-1.097-.298-4.043-5.453-3.744-6.549s5.453-4.042 6.549-3.743c1.095.298 4.042 5.453 3.743 6.549c-.298 1.095-5.453 4.042-6.549 3.743"/></svg>
    </div>
  </div>

  <!-- Top Bar -->
  <div class="top-bar page-enter">
    <a href="emo.html" class="back-btn" aria-label="Back to main site">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="15 18 9 12 15 6"/></svg>
      $EMO
    </a>
    <div class="top-bar-right">
      <span class="meme-count" id="memeCount"></span>
      <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark and light theme">
        <span class="icon-sun">&#9680;</span>
        <span class="icon-moon">&#9681;</span>
      </button>
    </div>
  </div>

  <div class="container page-enter" style="animation-delay: 0.05s">
    <div class="header">
      <h1>$EMO Memes</h1>
      <p>i lost it all on day 1</p>
    </div>

    <div class="meme-grid" id="memeGrid"></div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-label="Meme viewer" aria-modal="true">
    <button class="lightbox-close" id="lightboxClose" aria-label="Close viewer">&times;</button>
    <button class="lightbox-nav lightbox-prev" id="lightboxPrev" aria-label="Previous meme">&#10094;</button>
    <img class="lightbox-media" src="" alt="Full size meme" id="lightboxImg">
    <video class="lightbox-media" id="lightboxVideo" controls playsinline loop style="display:none"></video>
    <button class="lightbox-nav lightbox-next" id="lightboxNext" aria-label="Next meme">&#10095;</button>
    <div class="lightbox-bottom">
      <div class="lightbox-counter" id="lightboxCounter"></div>
      <a class="lightbox-download" id="lightboxDownload" href="" download aria-label="Download meme">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      </a>
    </div>
  </div>

  <!-- Back to Top -->
  <button class="back-to-top" id="backToTop" aria-label="Back to top">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
  </button>

  <script src="meme_list.js"></script>

  <script>
    // ── Theme ──
    const html = document.documentElement;
    const savedTheme = localStorage.getItem('theme') ||
      (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');
    html.setAttribute('data-theme', savedTheme);

    document.getElementById('themeToggle').addEventListener('click', () => {
      html.classList.add('theme-transition');
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      setTimeout(() => html.classList.remove('theme-transition'), 350);
    });

    // ── Build Grid ──
    const memeGrid = document.getElementById('memeGrid');
    const mediaFiles = MEME_FILES.filter(f => !f.endsWith('.mp4'));
    const videoFiles = MEME_FILES.filter(f => f.endsWith('.mp4'));

    // Show count
    document.getElementById('memeCount').textContent = MEME_FILES.length + ' memes';

    // Images
    mediaFiles.forEach(filename => {
      const div = document.createElement('div');
      div.className = 'meme-item';
      div.setAttribute('tabindex', '0');
      div.setAttribute('role', 'button');
      div.setAttribute('aria-label', 'View meme: ' + filename);
      const img = document.createElement('img');
      img.src = 'memes/' + filename;
      img.alt = 'Meme';
      img.loading = 'lazy';
      img.setAttribute('data-loading', 'true');
      img.addEventListener('load', () => img.removeAttribute('data-loading'));
      img.addEventListener('error', () => div.classList.add('error'));
      div.appendChild(img);
      memeGrid.appendChild(div);
    });

    // Videos
    videoFiles.forEach(filename => {
      const div = document.createElement('div');
      div.className = 'meme-item';
      const video = document.createElement('video');
      video.src = 'memes/' + filename;
      video.muted = true;
      video.loop = true;
      video.playsInline = true;
      video.preload = 'metadata';
      video.addEventListener('mouseenter', () => video.play());
      video.addEventListener('mouseleave', () => { video.pause(); video.currentTime = 0; });
      video.addEventListener('error', () => div.classList.add('error'));
      div.appendChild(video);
      memeGrid.appendChild(div);
    });

    // ── Lightbox ──
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const lightboxVideo = document.getElementById('lightboxVideo');
    const lightboxClose = document.getElementById('lightboxClose');
    const lightboxPrev = document.getElementById('lightboxPrev');
    const lightboxNext = document.getElementById('lightboxNext');
    const lightboxCounter = document.getElementById('lightboxCounter');
    const lightboxDownload = document.getElementById('lightboxDownload');

    const memeItems = Array.from(document.querySelectorAll('.meme-item'));
    const allMedia = memeItems.map(item => {
      const img = item.querySelector('img');
      const video = item.querySelector('video');
      if (img) return { src: img.src, type: 'image' };
      if (video) return { src: video.src, type: 'video' };
      return null;
    }).filter(Boolean);

    let currentIndex = 0;
    let previousFocus = null;

    function openLightbox(index) {
      previousFocus = document.activeElement;
      currentIndex = index;
      updateLightbox();
      lightbox.classList.add('active');
      lightboxClose.focus();
    }

    function closeLightbox() {
      lightbox.classList.remove('active');
      lightboxVideo.pause();
      lightboxVideo.src = '';
      if (previousFocus) previousFocus.focus();
    }

    function updateLightbox() {
      const media = allMedia[currentIndex];
      if (media.type === 'video') {
        lightboxImg.style.display = 'none';
        lightboxVideo.style.display = '';
        lightboxVideo.src = media.src;
        lightboxVideo.play();
        lightboxImg.src = '';
      } else {
        lightboxVideo.pause();
        lightboxVideo.style.display = 'none';
        lightboxVideo.src = '';
        lightboxImg.style.display = '';
        lightboxImg.src = media.src;
      }
      lightboxCounter.textContent = (currentIndex + 1) + ' / ' + allMedia.length;
      lightboxDownload.href = media.src;
    }

    function showMeme(index) {
      if (index < 0) index = allMedia.length - 1;
      if (index >= allMedia.length) index = 0;
      currentIndex = index;
      updateLightbox();
    }

    // Click to open
    memeItems.forEach((item, idx) => {
      item.setAttribute('tabindex', '0');
      item.setAttribute('role', 'button');
      item.addEventListener('click', () => openLightbox(idx));
      item.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openLightbox(idx); }
      });
    });

    // Navigation
    lightboxPrev.addEventListener('click', (e) => { e.stopPropagation(); showMeme(currentIndex - 1); });
    lightboxNext.addEventListener('click', (e) => { e.stopPropagation(); showMeme(currentIndex + 1); });
    lightboxClose.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });

    // Keyboard
    document.addEventListener('keydown', (e) => {
      if (!lightbox.classList.contains('active')) return;
      if (e.key === 'Escape') closeLightbox();
      else if (e.key === 'ArrowLeft') showMeme(currentIndex - 1);
      else if (e.key === 'ArrowRight') showMeme(currentIndex + 1);
      // Focus trap
      else if (e.key === 'Tab') {
        const focusable = lightbox.querySelectorAll('button, a');
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
        if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
      }
    });

    // ── Touch Swipe ──
    (function() {
      let startX = 0;
      let startY = 0;
      let swiping = false;

      lightbox.addEventListener('touchstart', (e) => {
        if (e.target === lightboxClose || e.target.closest('.lightbox-nav') || e.target.closest('.lightbox-download')) return;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        swiping = true;
      }, { passive: true });

      lightbox.addEventListener('touchend', (e) => {
        if (!swiping) return;
        swiping = false;
        const dx = e.changedTouches[0].clientX - startX;
        const dy = e.changedTouches[0].clientY - startY;
        if (Math.abs(dx) < 50 || Math.abs(dy) > Math.abs(dx)) return;
        if (dx > 0) showMeme(currentIndex - 1);
        else showMeme(currentIndex + 1);
      }, { passive: true });
    })();

    // ── Back to Top ──
    const backToTop = document.getElementById('backToTop');
    window.addEventListener('scroll', () => {
      backToTop.classList.toggle('visible', window.scrollY > 400);
    }, { passive: true });

    backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>

  <script>
    // ── Page Transition ──
    (function() {
      const pt = document.getElementById('pageTransition');
      if (!pt) return;
      let navigating = false;

      // Entrance: hide overlay elements after animation completes
      const hideTimeout = setTimeout(() => {
        pt.querySelector('.pt-overlay').style.display = 'none';
        pt.querySelector('.pt-logo').style.display = 'none';
        pt.querySelector('.pt-glow').style.display = 'none';
      }, 1600);

      // Exit: intercept back link to emo.html
      document.addEventListener('click', (e) => {
        const link = e.target.closest('a[href]');
        if (!link) return;
        const href = link.getAttribute('href');
        if (href !== 'emo.html' && !href.endsWith('/emo.html')) return;

        e.preventDefault();
        if (navigating) return;
        navigating = true;
        clearTimeout(hideTimeout);
        pt.querySelector('.pt-overlay').style.display = '';
        pt.querySelector('.pt-logo').style.display = '';
        pt.querySelector('.pt-glow').style.display = '';
        pt.classList.add('exit-active');
        sessionStorage.setItem('pt-entering', '1');

        setTimeout(() => {
          window.location.href = href;
        }, 1400);
      });
    })();
  </script>

</body>
</html>
